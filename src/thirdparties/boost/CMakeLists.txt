cmake_minimum_required(VERSION 2.8 FATAL_ERROR)
project(khewil-thirdparty-boost)

if("${KHEWIL_BOOST_BUILD_DIR}" STREQUAL "")
	set(KHEWIL_BOOST_BUILD_DIR "${CMAKE_CURRENT_BINARY_DIR}")
endif()
message(STATUS "KHEWIL_BOOST_BUILD_DIR=${KHEWIL_BOOST_BUILD_DIR}")

if("${KHEWIL_BOOST_SOURCE_NAME}" STREQUAL "")
	set(KHEWIL_BOOST_SOURCE_NAME "boost_1_59_0")
endif()
message(STATUS "KHEWIL_BOOST_SOURCE_NAME=${KHEWIL_BOOST_SOURCE_NAME}")

if("${KHEWIL_BOOST_SOURCE_DIR}" STREQUAL "")
	set(KHEWIL_BOOST_SOURCE_DIR "${KHEWIL_THIRDPARTIES_SOURCE_DIR}/${KHEWIL_BOOST_SOURCE_NAME}")
endif()
message(STATUS "KHEWIL_BOOST_SOURCE_DIR=${KHEWIL_BOOST_SOURCE_DIR}")

if("${KHEWIL_BOOST_INSTALL_NAME}" STREQUAL "")
	set(KHEWIL_BOOST_INSTALL_NAME "boost-1.59.0")
endif()
message(STATUS "KHEWIL_BOOST_INSTALL_NAME=${KHEWIL_BOOST_INSTALL_NAME}")

if("${KHEWIL_BOOST_INSTALL_DIR}" STREQUAL "")
	set(KHEWIL_BOOST_INSTALL_DIR "${KHEWIL_THIRDPARTIES_INSTALL_DIR}/${KHEWIL_BOOST_INSTALL_NAME}" PARENT_SCOPE)
endif()
message(STATUS "KHEWIL_BOOST_INSTALL_DIR=${KHEWIL_BOOST_INSTALL_DIR}")

add_custom_target(
	khewil-boost-build
	COMMAND b2.exe toolset=msvc-12.0 threading=multi runtime-link=shared link=shared address-model=32 "--stagedir=${KHEWIL_BOOST_BUILD_DIR}/stage" --with-thread
	WORKING_DIRECTORY "${KHEWIL_BOOST_SOURCE_DIR}"
	)

if(NOT EXISTS "${KHEWIL_BOOST_SOURCE_DIR}/b2.exe")
	add_custom_command(
		TARGET khewil-boost-build
		PRE_BUILD
		COMMAND bootstrap.bat
		WORKING_DIRECTORY "${KHEWIL_BOOST_SOURCE_DIR}"
		)
endif()

add_custom_target(
	khewil-boost-install
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_BOOST_BUILD_DIR}/stage/lib" "-DKHEWIL_UTIL_SOURCE_FILTER=*.lib" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_BOOST_INSTALL_DIR}/lib" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_BOOST_BUILD_DIR}/stage/lib" "-DKHEWIL_UTIL_SOURCE_FILTER=*.dll" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_BOOST_INSTALL_DIR}/bin" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_BOOST_SOURCE_DIR}/boost" "-DKHEWIL_UTIL_SOURCE_FILTER=*.*" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_BOOST_INSTALL_DIR}/inc/boost" "-DKHEWIL_UTIL_RECURSIVE=TRUE" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	)
