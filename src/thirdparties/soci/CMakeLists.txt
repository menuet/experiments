cmake_minimum_required(VERSION 2.8 FATAL_ERROR)
project(khewil-thirdparty-soci)

if("${KHEWIL_SOCI_BUILD_DIR}" STREQUAL "")
	set(KHEWIL_SOCI_BUILD_DIR "${CMAKE_CURRENT_BINARY_DIR}")
endif()
message(STATUS "KHEWIL_SOCI_BUILD_DIR=${KHEWIL_SOCI_BUILD_DIR}")

if("${KHEWIL_SOCI_SOURCE_NAME}" STREQUAL "")
	set(KHEWIL_SOCI_SOURCE_NAME "soci-3.2.3")
endif()
message(STATUS "KHEWIL_SOCI_SOURCE_NAME=${KHEWIL_SOCI_SOURCE_NAME}")

if("${KHEWIL_SOCI_SOURCE_DIR}" STREQUAL "")
	set(KHEWIL_SOCI_SOURCE_DIR "${KHEWIL_THIRDPARTIES_SOURCE_DIR}/${KHEWIL_SOCI_SOURCE_NAME}")
endif()
message(STATUS "KHEWIL_SOCI_SOURCE_DIR=${KHEWIL_SOCI_SOURCE_DIR}")

if("${KHEWIL_SOCI_INSTALL_NAME}" STREQUAL "")
	set(KHEWIL_SOCI_INSTALL_NAME "soci-3.2.3")
endif()
message(STATUS "KHEWIL_SOCI_INSTALL_NAME=${KHEWIL_SOCI_INSTALL_NAME}")

if("${KHEWIL_SOCI_INSTALL_DIR}" STREQUAL "")
	set(KHEWIL_SOCI_INSTALL_DIR "${KHEWIL_THIRDPARTIES_INSTALL_DIR}/${KHEWIL_SOCI_INSTALL_NAME}")
endif()
message(STATUS "KHEWIL_SOCI_INSTALL_DIR=${KHEWIL_SOCI_INSTALL_DIR}")

add_custom_target(
	khewil-soci-build
	COMMAND ${CMAKE_COMMAND} -G "${CMAKE_GENERATOR}" -D "SQLITE_ROOT_DIR=${KHEWIL_SQLITE_INSTALL_DIR}" -D "SQLITE_INCLUDE_DIR=${KHEWIL_SQLITE_INSTALL_DIR}/inc" -D "SQLITE_LIBRARIES=${KHEWIL_SQLITE_INSTALL_DIR}/lib" "${KHEWIL_SOCI_SOURCE_DIR}"
	WORKING_DIRECTORY "${KHEWIL_SOCI_BUILD_DIR}"
	)

add_custom_target(
	khewil-soci-install
	${CMAKE_COMMAND} -E copy_if_different "${KHEWIL_SOCI_SOURCE_DIR}/soci.h" "${KHEWIL_SOCI_INSTALL_DIR}/inc/soci/soci.h"
	COMMAND ${CMAKE_COMMAND} -E copy_if_different "${KHEWIL_SOCI_SOURCE_DIR}/sociext.h" "${KHEWIL_SOCI_INSTALL_DIR}/inc/soci/sociext.h"
	COMMAND ${CMAKE_COMMAND} -E copy_if_different "${KHEWIL_SOCI_BUILD_DIR}/soci.lib" "${KHEWIL_SOCI_INSTALL_DIR}/lib/soci.lib"
	COMMAND ${CMAKE_COMMAND} -E copy_if_different "${KHEWIL_SOCI_BUILD_DIR}/soci.dll" "${KHEWIL_SOCI_INSTALL_DIR}/bin/soci.dll"
	)
