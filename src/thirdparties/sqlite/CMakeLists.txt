cmake_minimum_required(VERSION 2.8 FATAL_ERROR)
project(khewil-thirdparty-sqlite)

if("${KHEWIL_SQLITE_BUILD_DIR}" STREQUAL "")
	set(KHEWIL_SQLITE_BUILD_DIR "${CMAKE_CURRENT_BINARY_DIR}")
endif()
message(STATUS "KHEWIL_SQLITE_BUILD_DIR=${KHEWIL_SQLITE_BUILD_DIR}")

if("${KHEWIL_SQLITE_SOURCE_NAME}" STREQUAL "")
	set(KHEWIL_SQLITE_SOURCE_NAME "sqlite-amalgamation-3090100")
endif()
message(STATUS "KHEWIL_SQLITE_SOURCE_NAME=${KHEWIL_SQLITE_SOURCE_NAME}")

if("${KHEWIL_SQLITE_SOURCE_DIR}" STREQUAL "")
	set(KHEWIL_SQLITE_SOURCE_DIR "${KHEWIL_THIRDPARTIES_SOURCE_DIR}/${KHEWIL_SQLITE_SOURCE_NAME}")
endif()
message(STATUS "KHEWIL_SQLITE_SOURCE_DIR=${KHEWIL_SQLITE_SOURCE_DIR}")

if("${KHEWIL_SQLITE_INSTALL_NAME}" STREQUAL "")
	set(KHEWIL_SQLITE_INSTALL_NAME "sqlite-3.9.1")
endif()
message(STATUS "KHEWIL_SQLITE_INSTALL_NAME=${KHEWIL_SQLITE_INSTALL_NAME}")

if("${KHEWIL_SQLITE_INSTALL_DIR}" STREQUAL "")
	set(KHEWIL_SQLITE_INSTALL_DIR "${KHEWIL_THIRDPARTIES_INSTALL_DIR}/${KHEWIL_SQLITE_INSTALL_NAME}")
	set(KHEWIL_SQLITE_INSTALL_DIR "${KHEWIL_THIRDPARTIES_INSTALL_DIR}/${KHEWIL_SQLITE_INSTALL_NAME}" PARENT_SCOPE)
endif()
message(STATUS "KHEWIL_SQLITE_INSTALL_DIR=${KHEWIL_SQLITE_INSTALL_DIR}")

add_custom_target(
	khewil-sqlite-build
	COMMAND cl "/LD" "${KHEWIL_SQLITE_SOURCE_DIR}/sqlite3.c" "/IMPLIB:sqlite3.lib" "/DSQLITE_API=__declspec(dllexport)"
	)

add_custom_target(
	khewil-sqlite-install
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_SQLITE_BUILD_DIR}" "-DKHEWIL_UTIL_SOURCE_FILTER=*.lib" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_SQLITE_INSTALL_DIR}/lib" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_SQLITE_BUILD_DIR}" "-DKHEWIL_UTIL_SOURCE_FILTER=*.dll" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_SQLITE_INSTALL_DIR}/bin" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_SQLITE_SOURCE_DIR}" "-DKHEWIL_UTIL_SOURCE_FILTER=*.h" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_SQLITE_INSTALL_DIR}/inc/sqlite" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	)

add_dependencies(khewil-sqlite-install khewil-sqlite-build)
