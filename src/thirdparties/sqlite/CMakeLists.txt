cmake_minimum_required(VERSION 2.8 FATAL_ERROR)
project(khewil-thirdparty-sqlite)

if("${KHEWIL_SQLITE_BUILD_DIR}" STREQUAL "")
	set(KHEWIL_SQLITE_BUILD_DIR "${CMAKE_CURRENT_BINARY_DIR}")
endif()
message(STATUS "KHEWIL_SQLITE_BUILD_DIR=${KHEWIL_SQLITE_BUILD_DIR}")

if("${KHEWIL_SQLITE_SOURCE_NAME}" STREQUAL "")
	set(KHEWIL_SQLITE_SOURCE_NAME "sqlite-amalgamation-3090100")
endif()
message(STATUS "KHEWIL_SQLITE_SOURCE_NAME=${KHEWIL_SQLITE_SOURCE_NAME}")

if("${KHEWIL_SQLITE_SOURCE_DIR}" STREQUAL "")
	set(KHEWIL_SQLITE_SOURCE_DIR "${KHEWIL_THIRDPARTIES_SOURCE_DIR}/${KHEWIL_SQLITE_SOURCE_NAME}")
endif()
message(STATUS "KHEWIL_SQLITE_SOURCE_DIR=${KHEWIL_SQLITE_SOURCE_DIR}")

if("${KHEWIL_SQLITE_INSTALL_NAME}" STREQUAL "")
	set(KHEWIL_SQLITE_INSTALL_NAME "sqlite-3.9.1")
endif()
message(STATUS "KHEWIL_SQLITE_INSTALL_NAME=${KHEWIL_SQLITE_INSTALL_NAME}")

if("${KHEWIL_SQLITE_INSTALL_DIR}" STREQUAL "")
	set(KHEWIL_SQLITE_INSTALL_DIR "${KHEWIL_THIRDPARTIES_INSTALL_DIR}/${KHEWIL_SQLITE_INSTALL_NAME}")
endif()
message(STATUS "KHEWIL_SQLITE_INSTALL_DIR=${KHEWIL_SQLITE_INSTALL_DIR}")

add_custom_target(
	khewil-sqlite-build
	COMMAND cl "/LD" "${KHEWIL_SQLITE_SOURCE_DIR}/sqlite3.c" "/IMPLIB:sqlite3.lib" "/DSQLITE_API=__declspec(dllexport)"
	)

add_custom_target(
	khewil-sqlite-install
	${CMAKE_COMMAND} -E copy_if_different "${KHEWIL_SQLITE_SOURCE_DIR}/sqlite3.h" "${KHEWIL_SQLITE_INSTALL_DIR}/inc/sqlite/sqlite3.h"
	COMMAND ${CMAKE_COMMAND} -E copy_if_different "${KHEWIL_SQLITE_SOURCE_DIR}/sqlite3ext.h" "${KHEWIL_SQLITE_INSTALL_DIR}/inc/sqlite/sqlite3ext.h"
	COMMAND ${CMAKE_COMMAND} -E copy_if_different "${KHEWIL_SQLITE_BUILD_DIR}/sqlite3.lib" "${KHEWIL_SQLITE_INSTALL_DIR}/lib/sqlite3.lib"
	COMMAND ${CMAKE_COMMAND} -E copy_if_different "${KHEWIL_SQLITE_BUILD_DIR}/sqlite3.dll" "${KHEWIL_SQLITE_INSTALL_DIR}/bin/sqlite3.dll"
	)
