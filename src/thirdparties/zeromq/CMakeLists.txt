cmake_minimum_required(VERSION 2.8 FATAL_ERROR)
project(khewil-thirdparty-zeromq)

if("${KHEWIL_ZEROMQ_BUILD_DIR}" STREQUAL "")
	set(KHEWIL_ZEROMQ_BUILD_DIR "${CMAKE_CURRENT_BINARY_DIR}")
endif()
message(STATUS "KHEWIL_ZEROMQ_BUILD_DIR=${KHEWIL_ZEROMQ_BUILD_DIR}")

if("${KHEWIL_ZEROMQ_SOURCE_NAME}" STREQUAL "")
	set(KHEWIL_ZEROMQ_SOURCE_NAME "zeromq-4.1.3")
endif()
message(STATUS "KHEWIL_ZEROMQ_SOURCE_NAME=${KHEWIL_ZEROMQ_SOURCE_NAME}")

if("${KHEWIL_ZEROMQ_SOURCE_DIR}" STREQUAL "")
	set(KHEWIL_ZEROMQ_SOURCE_DIR "${KHEWIL_THIRDPARTIES_SOURCE_DIR}/${KHEWIL_ZEROMQ_SOURCE_NAME}")
endif()
message(STATUS "KHEWIL_ZEROMQ_SOURCE_DIR=${KHEWIL_ZEROMQ_SOURCE_DIR}")

if("${KHEWIL_ZEROMQ_INSTALL_NAME}" STREQUAL "")
	set(KHEWIL_ZEROMQ_INSTALL_NAME "zeromq-4.1.3")
endif()
message(STATUS "KHEWIL_ZEROMQ_INSTALL_NAME=${KHEWIL_ZEROMQ_INSTALL_NAME}")

if("${KHEWIL_ZEROMQ_INSTALL_DIR}" STREQUAL "")
	set(KHEWIL_ZEROMQ_INSTALL_DIR "${KHEWIL_THIRDPARTIES_INSTALL_DIR}/${KHEWIL_ZEROMQ_INSTALL_NAME}")
endif()
message(STATUS "KHEWIL_ZEROMQ_INSTALL_DIR=${KHEWIL_ZEROMQ_INSTALL_DIR}")

add_custom_target(
	khewil-zeromq-build
	COMMAND "${KHEWIL_TOOL_MSBUILD}" "${KHEWIL_ZEROMQ_SOURCE_DIR}/builds/msvc/vs2013/libzmq/libzmq.vcxproj" -p:Configuration=ReleaseDLL -p:Platform=Win32 -p:PlatformToolset=v120 "-p:SolutionDir=${KHEWIL_ZEROMQ_SOURCE_DIR}/builds/msvc/vs2013/" -p:Option-sodium=false -p:Linkage-libsodium=
	WORKING_DIRECTORY "${KHEWIL_ZEROMQ_SOURCE_DIR}"
	COMMENT "Building zeromq solution ${KHEWIL_ZEROMQ_SOURCE_DIR}/builds/msvc/vs2013/libzmq.sln"
	)

add_custom_target(
	khewil-zeromq-install
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_ZEROMQ_SOURCE_DIR}/bin/Win32/Release/v120/dynamic" "-DKHEWIL_UTIL_SOURCE_FILTER=*.lib" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_ZEROMQ_INSTALL_DIR}/lib" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_ZEROMQ_SOURCE_DIR}/bin/Win32/Release/v120/dynamic" "-DKHEWIL_UTIL_SOURCE_FILTER=*.dll" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_ZEROMQ_INSTALL_DIR}/bin" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_ZEROMQ_SOURCE_DIR}/include" "-DKHEWIL_UTIL_SOURCE_FILTER=*.h" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_ZEROMQ_INSTALL_DIR}/inc/zeromq" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	)
