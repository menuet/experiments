cmake_minimum_required(VERSION 2.8 FATAL_ERROR)
project(khewil-thirdparty-mongo)

if("${KHEWIL_MONGO_BUILD_DIR}" STREQUAL "")
	set(KHEWIL_MONGO_BUILD_DIR "${CMAKE_CURRENT_BINARY_DIR}")
endif()
message(STATUS "KHEWIL_MONGO_BUILD_DIR=${KHEWIL_MONGO_BUILD_DIR}")

if("${KHEWIL_MONGO_SOURCE_NAME}" STREQUAL "")
	set(KHEWIL_MONGO_SOURCE_NAME "mongo-cxx-driver")
endif()
message(STATUS "KHEWIL_MONGO_SOURCE_NAME=${KHEWIL_MONGO_SOURCE_NAME}")

if("${KHEWIL_MONGO_SOURCE_DIR}" STREQUAL "")
	set(KHEWIL_MONGO_SOURCE_DIR "${KHEWIL_THIRDPARTIES_SOURCE_DIR}/${KHEWIL_MONGO_SOURCE_NAME}")
endif()
message(STATUS "KHEWIL_MONGO_SOURCE_DIR=${KHEWIL_MONGO_SOURCE_DIR}")

if("${KHEWIL_MONGO_INSTALL_NAME}" STREQUAL "")
	set(KHEWIL_MONGO_INSTALL_NAME "mongo-1.0.6")
endif()
message(STATUS "KHEWIL_MONGO_INSTALL_NAME=${KHEWIL_MONGO_INSTALL_NAME}")

if("${KHEWIL_MONGO_INSTALL_DIR}" STREQUAL "")
	set(KHEWIL_MONGO_INSTALL_DIR "${KHEWIL_THIRDPARTIES_INSTALL_DIR}/${KHEWIL_MONGO_INSTALL_NAME}")
endif()
message(STATUS "KHEWIL_MONGO_INSTALL_DIR=${KHEWIL_MONGO_INSTALL_DIR}")

add_custom_target(
	khewil-mongo-build
	COMMAND "${KHEWIL_TOOL_SCONS}" --prefix=${KHEWIL_MONGO_BUILD_DIR}/prefix --dynamic-windows=on --dynamic-boost=off --c++11=on --dbg=off --msvc-version=12.0 --msvc-host-arch=x86 "--cpppath=${KHEWIL_BOOST_INSTALL_DIR}/inc" "--libpath=${KHEWIL_BOOST_INSTALL_DIR}/lib" install
	WORKING_DIRECTORY "${KHEWIL_MONGO_SOURCE_DIR}"
	COMMENT "Building mongo-cxx using boost headers in ${KHEWIL_BOOST_INSTALL_DIR}/inc and boost libs in ${KHEWIL_BOOST_INSTALL_DIR}/lib"
	)

add_custom_target(
	khewil-mongo-install
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_MONGO_BUILD_DIR}/prefix/lib" "-DKHEWIL_UTIL_SOURCE_FILTER=*.lib" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_MONGO_INSTALL_DIR}/lib" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	COMMAND ${CMAKE_COMMAND} "-DKHEWIL_UTIL_METHOD=COPY_FILES" "-DKHEWIL_UTIL_SOURCE_DIR=${KHEWIL_MONGO_BUILD_DIR}/prefix/include" "-DKHEWIL_UTIL_SOURCE_FILTER=*.*" "-DKHEWIL_UTIL_TARGET_DIR=${KHEWIL_MONGO_INSTALL_DIR}/inc" "-DKHEWIL_UTIL_RECURSIVE=TRUE" -P "${KHEWIL_CMAKE_MODULES_DIR}/utils.cmake"
	)
